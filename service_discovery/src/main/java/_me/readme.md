2019-09-12

## 如何实现一个服务发现组件

### 解决的问题
1. 怎么让服务消费者 总能 找到服务提供者
2. 怎样才能让服务器消费者 感知 服务提供者地址的变化

### 1
1. Consumer <--> mysql <--> Producer
2. Registry 表
    - id, server_name, ip, port, status
3. 查找
    - select * from registry where server_name="xxx" and status = "up"
4. 问题
    - producer 主要在宕机/停机 前修改 状态
    - consumer 每次调用前 都需要 select, 加大服务发现组件的压力, 去中心化
    - 服务发现组件 宕机了呢...
    
### 三者关系
1. producer 到 发现组件 注册
2. consumer 到 发现组件 查询
3. 各个组件 和 发现组件 保持心跳
4. 客户端缓存

### 服务发现组件的主要功能
1. 注册
2. 心跳检测
3. 超时剔除
4. 

### 更高的要求
1. 高可用
2. 实时更新

### 服务发现方式
1. 服务端发现
    - 最终请求由服务器段发起, 然后转发到 消费者
2. 客户端发现
    - 消费者自己去发起请求